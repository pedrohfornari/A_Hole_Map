<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>A_(W)Hole_Map: detector Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="../../classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="../../functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>detector Class Reference</h1><!-- doxytag: class="detector" -->
<p><code>#include &lt;<a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>&gt;</code></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">detector</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp21aed3df2077b5d91ce46bf123446731"></a> Functionality</p>
<p>Using the inputs from the sensors, the <a class="el" href="../../dc/d8f/classdetector.html">detector</a> will use the selected algorithm to try and find the moments the holes are detected, and then output a bool hole_detected to indicate the detection. </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#aaeb0fd3b3e932e40a6e8786525115e15">detector_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#aa8f16351ad3b1acd8961b97b20f14d8c">first_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a1a09eb1b2a455e9a310661a8f8021d9d">p1_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#aeb0fb51949b839ec42c4e08844795994">l1_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#ab47e971fafbff40d258b6289b41b6d22">l2_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a4742a6972065e875ccdc08423d9be065">p2_algorithm</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#af67bde976cca089bc94fa888e68021ce">kalman_filter</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#abc47c3a1bdb96a87f33ec29ad46edce1">SC_CTOR</a> (<a class="el" href="../../dc/d8f/classdetector.html">detector</a>)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a62563b2212d11aa1c76b1af631bc01d8">sensor1</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a5182ac2198946f3da30f70216d8a6678">sensor2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a0d5917d7ec9b65325f771ff992d7592c">sensor3</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#a8605a626bfca652ec25a25fd259ba40e">sensor4</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#afeaffa05c0270da9abdd6e4bb99693d3">timebase</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_out&lt; bool &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#aa6fcccbb937483f845714131c3ab34f8">hole_detected</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">sc_in_clk&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d8f/classdetector.html#ac1f19b862f3baa02191334f186ab0e5e">clk</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is the hole <a class="el" href="../../dc/d8f/classdetector.html">detector</a> module. We have 5 inputs, 1 output and a clock. The hole detection algorithm file receives 4 sensor data and a timebase, than it runs the data through some filters and tries to detect if there is a hole in that time sample or not. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sensor1</em>&nbsp;</td><td>input of the 1st of the four sensors; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sensor2</em>&nbsp;</td><td>input of the 2nd of the four sensors; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sensor3</em>&nbsp;</td><td>input of the 3rd of the four sensors; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sensor4</em>&nbsp;</td><td>input of the 4th of the four sensors; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timebase</em>&nbsp;</td><td>input of the microcontroller timebase; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>clk</em>&nbsp;</td><td>the clock; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hole_detected</em>&nbsp;</td><td>output to indicate if the hole was detected. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00028">28</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aaeb0fd3b3e932e40a6e8786525115e15"></a><!-- doxytag: member="detector::detector_algorithm" ref="aaeb0fd3b3e932e40a6e8786525115e15" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::detector_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>Here is chosen which algorithm will be used. There were made more than one algorithm in order to study different implementation behaviours.</p>
<p>The developed algorithms are: 1 - <a class="el" href="../../dc/d8f/classdetector.html#af67bde976cca089bc94fa888e68021ce">kalman_filter()</a>; 2 - <a class="el" href="../../dc/d8f/classdetector.html#aa8f16351ad3b1acd8961b97b20f14d8c">first_algorithm()</a>; 3 - <a class="el" href="../../dc/d8f/classdetector.html#a1a09eb1b2a455e9a310661a8f8021d9d">p1_algorithm()</a>; 4 - <a class="el" href="../../dc/d8f/classdetector.html#aeb0fb51949b839ec42c4e08844795994">l1_algorithm()</a>; 5 - <a class="el" href="../../dc/d8f/classdetector.html#ab47e971fafbff40d258b6289b41b6d22">l2_algorithm()</a>; 6 - <a class="el" href="../../dc/d8f/classdetector.html#a4742a6972065e875ccdc08423d9be065">p2_algorithm()</a>;</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00047">47</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="../../dc/d8f/classdetector_aaeb0fd3b3e932e40a6e8786525115e15_cgraph.png" border="0" usemap="#dc/d8f/classdetector_aaeb0fd3b3e932e40a6e8786525115e15_cgraph_map" alt=""></div>
<map name="dc/d8f/classdetector_aaeb0fd3b3e932e40a6e8786525115e15_cgraph_map" id="dc/d8f/classdetector_aaeb0fd3b3e932e40a6e8786525115e15_cgraph">
<area shape="rect" id="node3" href="../../dc/d8f/classdetector.html#a1a09eb1b2a455e9a310661a8f8021d9d" title="detector::p1_algorithm" alt="" coords="277,5,456,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa8f16351ad3b1acd8961b97b20f14d8c"></a><!-- doxytag: member="detector::first_algorithm" ref="aa8f16351ad3b1acd8961b97b20f14d8c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::first_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all vectors are initialized with zeros by default.</p>
<p>It is executed a loop to shift the samples' position within the vectors in order to receive a new data.</p>
<p>The sensors values are added in order to calculate a mean value. Thus, this is a moving average filter to be used in a future in order to compare the data.</p>
<p>The current data passes through a moving average filter to reduce noise.</p>
<p>If a hole is detected to any other hole near 80 samples, it is ignored for it's too close (LPF).</p>
<p>The hole_detected_flag is set to 1 if the difference between any of the sensors' current data and the mean exceeds the THRESHOLD and the rejection flag is not active.</p>
<p>Some debugging values will be calculated, as the number of holes detected (NOH) until now and the time of the occurance to compare to the real data aquisition.</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">231</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00038">REJECTED_HOLES</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00040">sensor4</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00039">THRESHOLD</a>, and <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>.</p>

</div>
</div>
<a class="anchor" id="a1a09eb1b2a455e9a310661a8f8021d9d"></a><!-- doxytag: member="detector::p1_algorithm" ref="a1a09eb1b2a455e9a310661a8f8021d9d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::p1_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all vectors are initialized with zeros by default.</p>
<p>It is executed a loop to shift the samples' position within the vectors in order to receive a new data.</p>
<p>If the sensors' value are out of the limits the counter is incremented.</p>
<p>New values are read and if they're out of the limits, the counter is incremented.</p>
<p>If a possible hole is detected near another hole by REJECTED_HOLES samples, it will be ignored.</p>
<p>If the possibility of a hole is seen a lot in a close sample interval, it will be considered a hole.</p>
<p>Some debugging values will be calculated, as the number of holes detected (NOH) until now and the time of the occurance to compare to the real data aquisition.</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
<p>In the end the counter is reset.</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">388</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00037">LOWER_LIMIT</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00038">REJECTED_HOLES</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l00036">UPPER_LIMIT</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00047">detector_algorithm()</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="../../dc/d8f/classdetector_a1a09eb1b2a455e9a310661a8f8021d9d_icgraph.png" border="0" usemap="#dc/d8f/classdetector_a1a09eb1b2a455e9a310661a8f8021d9d_icgraph_map" alt=""></div>
<map name="dc/d8f/classdetector_a1a09eb1b2a455e9a310661a8f8021d9d_icgraph_map" id="dc/d8f/classdetector_a1a09eb1b2a455e9a310661a8f8021d9d_icgraph">
<area shape="rect" id="node3" href="../../dc/d8f/classdetector.html#aaeb0fd3b3e932e40a6e8786525115e15" title="detector::detector_algorithm" alt="" coords="232,5,456,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeb0fb51949b839ec42c4e08844795994"></a><!-- doxytag: member="detector::l1_algorithm" ref="aeb0fb51949b839ec42c4e08844795994" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::l1_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all values are initialized with zeros by default.</p>
<p>The arrays are realocated to receive the new data. Also the mean value is recalculated.</p>
<p>The negative values of the data are set as positive.</p>
<p>The current data passes through a moving average filter to reduce noise.</p>
<p>If a variation is detected (hole_samples), but no other variation is detected close by, it is ignored (LPF).</p>
<p>The hole_detected_flag is set to 1 if the difference between any of the sensors' current data and the mean exceeds the THRESHOLD..</p>
<p>If the hole_detected_flag is set to 1, a possible hole is marked.</p>
<p>If a number of possible holes are detected closeby it will be considered a hole.</p>
<p>If any variation in the sensors bigger than the threshold is detected, and if there is't a hole nearby, the hole will be detected (HPF). 350000 because the car stopped there. 500 for it's the GPS resolution (assuming max car speed = 20m/s = 72km/h).</p>
<p>Some debugging values will be calculated, as the number of holes detected (NOH) until now and the time of the occurance to compare to the real data aquisition.</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">539</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00038">REJECTED_HOLES</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00040">sensor4</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00043">STOP_TIME</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00039">THRESHOLD</a>, and <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>.</p>

</div>
</div>
<a class="anchor" id="ab47e971fafbff40d258b6289b41b6d22"></a><!-- doxytag: member="detector::l2_algorithm" ref="ab47e971fafbff40d258b6289b41b6d22" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::l2_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all values are initialized with zeros by default.</p>
<p>The arrays are realocated to receive the new data. Also the mean value is recalculated.</p>
<p>The negative values of the data are set as positive.</p>
<p>The current data passes through a moving average filter to reduce noise.</p>
<p>The mean value is calculated using a moving average filter as well.</p>
<p>If a variation is detected (hole_samples), but no other variation is detected close by, it is ignored (LPF).</p>
<p>The compare_temp flag checks if the sum of the difference of each sensor's data with the mean exceeds 4 times the threshold.</p>
<p>If the hole_detected_flag is set to 1, a possible hole is marked.</p>
<p>If a number of possible holes are detected closeby it will be considered a hole.</p>
<p>If any variation in the sensors bigger than the threshold is detected, and if there is't a hole nearby, the hole will be detected (HPF). 500 because it's the GPS resolution (assuming max car speed = 20m/s = 72km/h).</p>
<p>Some debugging values will be calculated, as the number of holes detected (NOH) until now and the time of the occurance to compare to the real data aquisition.</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">758</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00038">REJECTED_HOLES</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00040">sensor4</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00043">STOP_TIME</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00039">THRESHOLD</a>, and <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>.</p>

</div>
</div>
<a class="anchor" id="a4742a6972065e875ccdc08423d9be065"></a><!-- doxytag: member="detector::p2_algorithm" ref="a4742a6972065e875ccdc08423d9be065" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::p2_algorithm </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all vectors are initialized with zeros by default.</p>
<p>The arrays are realocated to receive a new data.</p>
<p>The new values are converted to distance</p>
<p>The data is filtered.</p>
<p>It's checed if the values are out of the limits.</p>
<p>If a possible hole is detected near another hole by REJECTED_HOLES samples, it will be ignored.</p>
<p>It's then decided if it's a hole or not</p>
<p>Some debugging values will be calculated, as the number of holes detected (NOH) until now and the time of the occurance to compare to the real data aquisition.</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
<p>In the end the counter and the filtered values are reset.</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">1001</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00037">LOWER_LIMIT</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00038">REJECTED_HOLES</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l00036">UPPER_LIMIT</a>.</p>

</div>
</div>
<a class="anchor" id="af67bde976cca089bc94fa888e68021ce"></a><!-- doxytag: member="detector::kalman_filter" ref="af67bde976cca089bc94fa888e68021ce" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void detector::kalman_filter </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>In the variables' declaration, all vectors are initialized with zeros by default.</p>
<p>Then the Kalman filter coeficients are set: q = process noise; r = sensor noise; p = estimated error; k = kalman gain.</p>
<p>It is executed a loop to shift the samples' position within the vectors in order to receive a new data.</p>
<p>The sensors values are added in order to calculate a mean value. Thus, this is a moving average filter to be used in a future in order to compare the data.</p>
<p>The Kalman filter coeficients are recalculated in each iteration and used to all sensors. Also, the current sensor value passes through this filter.</p>
<p>A upper to the sensors' data is set in order to prevent failure in the filters</p>
<p>The mean values of the sensors are calculated and then compared to the current sample in order to check for possible holes. A variable adds up at each possible hole.</p>
<p>If the number of possible holes exceeds the NUMBER_OF_DETECTIONS we set, a hole detected flag will be set, and the counter of holes will be reset to 0.</p>
<p>If any variation in the sensors bigger than the threshold is detected, and if there is't a hole near the hole will be detected (High Pass Filter). 350000 because the car stopped there. 1000 because it's the GPS resolution (assuming max car speed = 20m/s = 72km/h).</p>
<p>Prints for debug:</p>
<p>cout &lt;&lt; "\n\n\n Iteration number: " &lt;&lt; Iter_num;</p>
<p>cout &lt;&lt; "\n Current data:    "&lt;&lt; sensor1_data.at(0)&lt;&lt;" "&lt;&lt;sensor2_data.at(0)&lt;&lt;" "&lt;&lt;sensor3_data.at(0); //Sensor current data filtered</p>
<p>cout &lt;&lt; "\n Mean data:       "&lt;&lt; sensor1_mean&lt;&lt;" "&lt;&lt;sensor2_mean&lt;&lt;" "&lt;&lt;sensor3_mean; //mean values being compared</p>
<p>cout &lt;&lt; "\n Data Difference: "&lt;&lt; abs(sensor1_mean-sensor1_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor2_mean-sensor2_data.at(0))&lt;&lt;" "&lt;&lt;abs(sensor3_mean-sensor3_data.at(0));</p>
<p>cout &lt;&lt; "\n Number of Holes detected: "&lt;&lt; NOH; // sum of holes detected</p>
<p>The time of detection is calculated from the timebase.</p>
<p>Time print for debug: cout &lt;&lt; "\n Time of the detection: "&lt;&lt;minutes&lt;&lt;":"&lt;&lt;seconds&lt;&lt;":"&lt;&lt;milliseconds&lt;&lt;"  Timebase: "&lt;&lt;timebase_data[0];</p>
</p>

<p>Definition at line <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">68</a> of file <a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a>.</p>

<p>References <a class="el" href="../../de/daf/detector_8cpp_source.html#l00035">ARRAY_SIZE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">hole_detected</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00042">NUMBER_OF_DETECTIONS</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00040">PROCESS_NOISE</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">sensor1</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">sensor2</a>, <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">sensor3</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00041">SENSOR_NOISE</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00043">STOP_TIME</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00039">THRESHOLD</a>, and <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">timebase</a>.</p>

</div>
</div>
<a class="anchor" id="abc47c3a1bdb96a87f33ec29ad46edce1"></a><!-- doxytag: member="detector::SC_CTOR" ref="abc47c3a1bdb96a87f33ec29ad46edce1" args="(detector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detector::SC_CTOR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d8f/classdetector.html">detector</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor SC_CTOR using SC_CTHREAD, based on the positive clock transition. </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00072">72</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

</div>
</div>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="a62563b2212d11aa1c76b1af631bc01d8"></a><!-- doxytag: member="detector::sensor1" ref="a62563b2212d11aa1c76b1af631bc01d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in&lt;int&gt; <a class="el" href="../../dc/d8f/classdetector.html#a62563b2212d11aa1c76b1af631bc01d8">detector::sensor1</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;int&gt; sensor1; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00031">31</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">kalman_filter()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">p2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="a5182ac2198946f3da30f70216d8a6678"></a><!-- doxytag: member="detector::sensor2" ref="a5182ac2198946f3da30f70216d8a6678" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in&lt;int&gt; <a class="el" href="../../dc/d8f/classdetector.html#a5182ac2198946f3da30f70216d8a6678">detector::sensor2</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;int&gt; sensor2; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00034">34</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">kalman_filter()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">p2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d5917d7ec9b65325f771ff992d7592c"></a><!-- doxytag: member="detector::sensor3" ref="a0d5917d7ec9b65325f771ff992d7592c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in&lt;int&gt; <a class="el" href="../../dc/d8f/classdetector.html#a0d5917d7ec9b65325f771ff992d7592c">detector::sensor3</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;int&gt; sensor3; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00037">37</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">kalman_filter()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">p2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="a8605a626bfca652ec25a25fd259ba40e"></a><!-- doxytag: member="detector::sensor4" ref="a8605a626bfca652ec25a25fd259ba40e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in&lt;int&gt; <a class="el" href="../../dc/d8f/classdetector.html#a8605a626bfca652ec25a25fd259ba40e">detector::sensor4</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;int&gt; sensor4; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00040">40</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="afeaffa05c0270da9abdd6e4bb99693d3"></a><!-- doxytag: member="detector::timebase" ref="afeaffa05c0270da9abdd6e4bb99693d3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in&lt;int&gt; <a class="el" href="../../dc/d8f/classdetector.html#afeaffa05c0270da9abdd6e4bb99693d3">detector::timebase</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;int&gt; timebase; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00043">43</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">kalman_filter()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">p2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="aa6fcccbb937483f845714131c3ab34f8"></a><!-- doxytag: member="detector::hole_detected" ref="aa6fcccbb937483f845714131c3ab34f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_out&lt;bool&gt; <a class="el" href="../../dc/d8f/classdetector.html#aa6fcccbb937483f845714131c3ab34f8">detector::hole_detected</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_out&lt;bool&gt; hole_detected; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00046">46</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

<p>Referenced by <a class="el" href="../../de/daf/detector_8cpp_source.html#l00231">first_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00068">kalman_filter()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00539">l1_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00758">l2_algorithm()</a>, <a class="el" href="../../de/daf/detector_8cpp_source.html#l00388">p1_algorithm()</a>, and <a class="el" href="../../de/daf/detector_8cpp_source.html#l01001">p2_algorithm()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1f19b862f3baa02191334f186ab0e5e"></a><!-- doxytag: member="detector::clk" ref="ac1f19b862f3baa02191334f186ab0e5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sc_in_clk <a class="el" href="../../dc/d8f/classdetector.html#ac1f19b862f3baa02191334f186ab0e5e">detector::clk</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Port sc_in&lt;clk&gt; clk; </p>

<p>Definition at line <a class="el" href="../../d5/d9f/detector_8h_source.html#l00049">49</a> of file <a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../d5/d9f/detector_8h_source.html">detector.h</a></li>
<li><a class="el" href="../../de/daf/detector_8cpp_source.html">detector.cpp</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Nov 2016 for A_(W)Hole_Map by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
